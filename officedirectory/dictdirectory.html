<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Directory Management</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --primary: #2ecc71;
      --primary-hover: #27ae60;
      --text-dark: #2c3e50;
      --bg-light: #f5f7fa;
      --bg-white: #ffffff;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg-light);
      margin: 0;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .header img {
      height: 55px;
      margin-right: 12px;
    }

    h2 {
      margin: 0;
      color: var(--text-dark);
    }

    .app-wrapper {
      width: 100%;
      margin: 0 auto;
      padding: 0 20px;
      box-sizing: border-box;
    }

    .form-container,
    .login-container {
      background: var(--bg-white);
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .form-container .form-row input,
    .form-container .form-row select {
      flex: 1 1 calc(33.333% - 12px);
      padding: 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-container button,
    .login-container button {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      padding: 12px 20px;
      font-size: 14px;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.2s;
    }

    .form-container button:hover,
    .login-container button:hover {
      background-color: var(--primary-hover);
    }

    .search-bar {
      margin-bottom: 15px;
    }

    .search-bar input {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.05);
      overflow: hidden;
    }

    thead {
      background-color: var(--text-dark);
      color: white;
    }

    th, td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .actions button {
      padding: 6px 12px;
      margin-right: 6px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .edit-btn { background-color: #3498db; color: white; }
    .copy-btn { background-color: #f1c40f; color: black; }
    .delete-btn { background-color: #e74c3c; color: white; }

    #logoutBtn {
      background-color: #e67e22;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
    }

.center-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 80vh;
  flex-direction: column; /* ✅ Helps with vertical stacking */
}


    @media (max-width: 768px) {
      .form-container .form-row input,
      .form-container .form-row select {
        flex: 1 1 100%;
      }

      table, thead, tbody, th, td, tr {
        display: block;
      }

      thead {
        display: none;
      }

      td {
        background: #f8f8f8;
        margin-bottom: 10px;
        padding: 12px;
      }

      td::before {
        font-weight: bold;
        display: block;
      }
    }
  </style>
</head>
<body>

<div class="header">
  <div style="display: flex; align-items: center;">
    <img src="dict_logo.png" alt="DICT Logo">
    <h2>Directory Management</h2>
  </div>
  <button id="logoutBtn" style="display:none;" onclick="logout()">Logout</button>
</div>

<div class="center-wrapper" id="loginSection">
  <div class="login-container">
    <h3 style="text-align:center;">Login</h3>
    <input type="email" id="email" placeholder="Email" style="width: 100%;" /><br />
    <input type="password" id="password" placeholder="Password" style="width: 100%;" /><br />
    <button onclick="login()" style="width: 100%;">Login</button>
  </div>
</div>

<div id="appSection" style="display:none;">
  <div class="app-wrapper">
    <div class="form-container">
      <div class="form-row">
        <select id="prefix">
          <option value="">--Prefix--</option>
          <option value="Hon.">Hon.</option>
          <option value="Gov.">Gov.</option>
          <option value="Mayor">Mayor</option>
          <option value="Vice Mayor">Vice Mayor</option>
          <option value="Dir.">Dir.</option>
          <option value="Engr.">Engr.</option>
          <option value="Atty.">Atty.</option>
          <option value="Dr.">Dr.</option>
          <option value="Mr.">Mr.</option>
          <option value="Ms.">Ms.</option>
        </select>
        <input type="text" id="name" placeholder="Full Name" />
        <input type="text" id="position" placeholder="Position" />
        <input type="text" id="office" placeholder="Office" />
        <input type="text" id="address" placeholder="Office Address" />
        <select id="category">
          <option value="NGA">NGA</option>
          <option value="LGU">LGU</option>
          <option value="Education">Education</option>
          <option value="Others">Others</option>
        </select>
      </div>
      <button id="submitBtn" onclick="addOrUpdateEntry()">Add Name</button>
    </div>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="🔍 Search" onkeyup="filterTable()" />
    </div>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Position</th>
          <th>Office</th>
          <th>Address</th>
          <th>Category</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="entryTableBody"></tbody>
    </table>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDa4LTo10L_Oq3wb0LScO4QZxoF0caaRZ8",
    authDomain: "dictcatanduanes-50aab.firebaseapp.com",
    projectId: "dictcatanduanes-50aab",
    storageBucket: "dictcatanduanes-50aab.appspot.com",
    messagingSenderId: "1071736633938",
    appId: "1:1071736633938:web:78e16d042e60fd7b25fd8b",
    measurementId: "G-KLRJ6WB7RB"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  let editId = null;

auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("appSection").style.display = "block";
    document.getElementById("logoutBtn").style.display = "inline";
    loadEntries();
  } else {
    document.getElementById("loginSection").style.display = "flex"; // ✅ Make sure this is "flex"
    document.getElementById("appSection").style.display = "none";
    document.getElementById("logoutBtn").style.display = "none";
  }
});


  function login() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, password)
      .catch(err => alert("Login failed: " + err.message));
  }

  function logout() {
    auth.signOut();
  }

  function addOrUpdateEntry() {
    const prefix = document.getElementById("prefix").value.trim();
    const name = document.getElementById("name").value.trim();
    const position = document.getElementById("position").value.trim();
    const office = document.getElementById("office").value.trim();
    const address = document.getElementById("address").value.trim();
    const category = document.getElementById("category").value;

    if (!name || !position || !office || !address) {
      alert("Please fill all fields.");
      return;
    }

    const entry = {
      prefix,
      name,
      position,
      office,
      address,
      category,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };

    if (editId) {
      db.collection("directory").doc(editId).update(entry)
        .then(() => {
          alert("✅ Entry updated!");
          editId = null;
          document.getElementById("submitBtn").innerText = "Add Name";
          clearForm();
          loadEntries();
        });
    } else {
      db.collection("directory").add(entry)
        .then(() => {
          alert("✅ Entry added!");
          clearForm();
          loadEntries();
        });
    }
  }

  function clearForm() {
    document.getElementById("prefix").value = "";
    document.getElementById("name").value = "";
    document.getElementById("position").value = "";
    document.getElementById("office").value = "";
    document.getElementById("address").value = "";
    document.getElementById("category").value = "NGA";
    editId = null;
  }

  function loadEntries() {
    const tbody = document.getElementById("entryTableBody");
    tbody.innerHTML = "";

    db.collection("directory").orderBy("timestamp", "desc").get()
      .then(snapshot => {
        snapshot.forEach(doc => {
          const d = doc.data();
          const fullName = `${d.prefix ? d.prefix + " " : ""}${d.name}`;
          const row = `
            <tr>
              <td>${fullName}</td>
              <td>${d.position}</td>
              <td>${d.office}</td>
              <td>${d.address}</td>
              <td>${d.category}</td>
              <td class="actions">
                <button class="edit-btn" onclick="editEntry('${doc.id}', \`${d.prefix}\`, \`${d.name}\`, \`${d.position}\`, \`${d.office}\`, \`${d.address}\`, \`${d.category}\`)">Edit</button>
                <button class="copy-btn" onclick="copyToClipboard(\`${fullName}\n${d.position}\n${d.office}\n${d.address}\`)">Copy</button>
                <button class="delete-btn" onclick="deleteEntry('${doc.id}')">Delete</button>
              </td>
            </tr>`;
          tbody.insertAdjacentHTML("beforeend", row);
        });
      });
  }

  function editEntry(id, prefix, name, position, office, address, category) {
    editId = id;
    document.getElementById("prefix").value = prefix;
    document.getElementById("name").value = name;
    document.getElementById("position").value = position;
    document.getElementById("office").value = office;
    document.getElementById("address").value = address;
    document.getElementById("category").value = category;
    document.getElementById("submitBtn").innerText = "Update Entry";
  }

  function deleteEntry(id) {
    if (confirm("Are you sure you want to delete this entry?")) {
      db.collection("directory").doc(id).delete().then(() => {
        alert("❌ Entry deleted.");
        loadEntries();
      });
    }
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert("📋 Copied to clipboard!");
    });
  }

  function filterTable() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const rows = document.getElementById("entryTableBody").getElementsByTagName("tr");

    for (let row of rows) {
      const cells = row.getElementsByTagName("td");
      const rowText = Array.from(cells).map(cell => cell.innerText.toLowerCase()).join(" ");
      row.style.display = rowText.includes(input) ? "" : "none";
    }
  }
</script>

</body>
</html>
